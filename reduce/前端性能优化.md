## æµè§ˆå™¨æ€§èƒ½ä¼˜åŒ–æªæ–½

### é‡‡ç”¨RAILæ¥æµ‹é‡ç½‘ç«™çš„æ€§èƒ½
- R:Responseï¼Œåœ¨100mså†…å“åº”ç”¨æˆ·çš„è¾“å…¥
- A:Animationï¼Œç”Ÿæˆä¸€å¸§åŠ¨ç”»éœ€è¦é™åˆ¶åœ¨16mså†…ï¼Œæµè§ˆå™¨éœ€è¦6mså·¦å³ï¼Œç•™ç»™jsçš„æ—¶é—´ä»…ä»…æœ‰10ms
- I:IDLE ä¿æŒä¸»çº¿ç¨‹å¤„äºç©ºé—²çŠ¶æ€ï¼Œäº¤ç»™ä¸»çº¿ç¨‹æ‰§è¡Œjsçš„æ—¶é—´è¦é™åˆ¶åœ¨50msä»¥å†…ï¼Œè¿™æ˜¯ä¸ºäº†èƒ½ä¿è¯åœ¨100mså†…å“åº”ç”¨æˆ·
- L:Loadé¡µé¢éœ€è¦åœ¨1så†…å‘ˆç°ï¼ˆæ¡†æ¶æˆ–è€…å¤§æ¦‚ï¼‰ï¼Œå…¶ä½™çš„èµ„æºå¯ä»¥åœ¨åå°åŠ è½½ï¼ˆåˆ©ç”¨ä¸»çº¿ç¨‹çš„idleæ—¶é—´ï¼Œä½†æ˜¯jsä»»åŠ¡æœ€å¥½ä¿æŒåœ¨50msä»¥å†…ï¼‰

### Loading Performance

#### æµ‹è¯•é¡µé¢çš„æ€§èƒ½
- chrome devtools auditsé¢æ¿ä¸­çš„lightHouseå·¥å…·
- PageSpeed Insightsï¼ˆhttps://developers.google.com/speed/pagespeed/insights/ï¼‰
- WebPageTestï¼ˆhttps://www.webpagetest.org/ï¼‰
- Pingdomï¼ˆhttps://tools.pingdom.com/ï¼‰

#### Text Contentå†…å®¹
- åˆ©ç”¨webpackã€gulpç­‰å·¥å…·å¯¹htmlã€jsã€cssæ–‡ä»¶è¿›è¡Œå‹ç¼©
- é‡‡ç”¨Gzipæ¥å‹ç¼©æ–‡ä»¶ï¼ˆå¯¹å›¾ç‰‡ç­‰å·²ç»å‹ç¼©è¿‡çš„å†…å®¹æ•ˆæœå¾ˆå°ï¼‰
- å¦‚ä½•åªé‡‡ç”¨ä¸€äº›åº“çš„å‡ ä¸ªå‡½æ•°ï¼Œè‡ªå·±æ‰‹å†™ï¼Œä¸è¦å¼•ç”¨

#### Graphical Content
- é¦–å…ˆè¦é—®ä¸€ä¸‹ä½ è‡ªå·±è¿™äº›å›¾ç‰‡æ˜¯ä¸æ˜¯éœ€è¦çš„
- é€‰æ‹©åˆé€‚çš„å›¾ç‰‡ç±»å‹ï¼Œåƒpngçš„å›¾åƒè§†è§‰æ•ˆæœæ¯”jpgè¦å¥½ï¼Œå°ºå¯¸ä¹Ÿå¤§ä¸€äº›ï¼Œä½†æ˜¯æœ‰æ—¶å€™åœ¨ç½‘é¡µä¸Šï¼Œpngã€jpgç±»å‹çš„å›¾ç‰‡æ ¹æœ¬çœ‹ä¸å‡ºåŒºåˆ«
- æœ‰äº›å›¾ç‰‡å­˜åœ¨ä¸€äº›metadataæ¯”æ–¹è¯´æƒ³ä½œè€…ï¼Œæ‹æ‘„è®¾å¤‡ç­‰ï¼Œå¯ä»¥é€šè¿‡ï¼ˆhttp://www.verexif.com/en/ï¼‰è¿™æ ·çš„ç½‘ç«™å»é™¤ç…§ç‰‡çš„metadata
- è£å‡å›¾ç‰‡ä¸å¿…è¦çš„åœ°æ–¹å¯ä»¥å‡å°‘å›¾ç‰‡çš„å°ºå¯¸
- é€šè¿‡ä¸€äº›å·¥å…·ï¼ˆpaint.netï¼‰èƒ½å‡å°‘å›¾ç‰‡çš„æ¸…æ™°åº¦å’Œå°ºå¯¸ï¼Œä½†æ˜¯åœ¨web pageä¸Šå¹¶ä¸ä¼šæœ‰æ˜æ˜¾çš„åŒºåˆ«ï¼Œéœ€è¦é€æ­¥è¿›è¡Œæµ‹è¯•
- ä¸€äº›ç½‘ç«™ï¼ˆhttps://tinypng.com/ï¼‰èƒ½å¤Ÿè¿›ä¸€æ­¥å‹ç¼©å›¾ç‰‡ï¼ŒåŒæ—¶è¿˜ä¸å½±å“å›¾ç‰‡çš„æ¸…æ™°åº¦

#### HTTP requests
- å°†å¤šä¸ªåˆ†æ•£çš„css fileã€js fileåˆå¹¶ä¸ºä¸€ä¸ªæ–‡ä»¶ï¼Œèƒ½æœ‰æ•ˆå‡å°‘httpè¯·æ±‚çš„æ¬¡æ•°ï¼Œä½†æ˜¯è¦æ³¨æ„*åŒåcsså±æ€§ã€jså‡½æ•°åå­—è¦†ç›–çš„é—®é¢˜*ï¼ˆHTTP2ä¸è¦è¿™æ ·ï¼‰

- å°†å¤šä¸ªå°çš„å›¾æ ‡ï¼ˆiconsï¼‰åˆæˆä¸ºä¸€å¼ é›ªç¢§å›¾ï¼Œé€šè¿‡css background positionå±æ€§å±•ç¤ºä¸åŒçš„iconeï¼Œèƒ½æœ‰æ•ˆåœ°èŠ‚çœå¸¦å®½ï¼ˆHTTP2ä¸è¦è¿™æ ·ï¼‰

- jsæ–‡ä»¶çš„ä¸‹è½½ä¼šé˜»å¡htmlé¡µé¢çš„æ¸²æŸ“ï¼Œå¯ä»¥å°†jsæ–‡ä»¶é“¾æ¥å­˜æ”¾åˆ°bodyæ ‡ç­¾çš„æœ€æœ«ï¼Œæ³¨æ„åªè¦jsæ‰§è¡Œçš„æ—¶å€™ï¼Œhtmlæ˜¯ä¸èƒ½è§£æçš„ï¼Œå› ä¸ºjså¯èƒ½è®¿é—®domå…ƒç´ 

  - <script src="demo.js">
      ä¼šç«‹å³åœæ­¢è§£æhtmlï¼Œä¸‹è½½jsæ–‡ä»¶ï¼Œå¹¶æ‰§è¡Œjsæ–‡ä»¶ï¼Œå®Œæˆåå†è§£æhtml
    </script>

    <script defer src="demo.js">
      ä¼šåœ¨è§£æhtmlçš„åŒæ—¶ä¸‹è½½jsæ–‡ä»¶ï¼Œå¹¶ä¿è¯åœ¨è¯¥jsçš„æ–‡ä»¶åœ¨htmlè§£æå®Œæˆä¹‹åï¼ŒDOMContentLoadedäº‹ä»¶è§¦å‘ä¹‹å‰å®Œæˆjsçš„æ‰§è¡Œ
    </script>

    <script src="demo.js">
      ä¼šåœ¨è§£æhtmlçš„åŒæ—¶ä¸‹è½½jsæ–‡ä»¶ï¼Œå½“jsä¸‹è½½å®Œæˆçš„æ—¶å€™ç«‹å³æ‰§è¡Œjsï¼Œå¹¶åœæ­¢htmlçš„è§£æ
    </script>

- ç›´æ¥å°†js codeå†™åœ¨éœ€è¦æ“ä½œdomé™„è¿‘çš„< script >æ ‡ç­¾å†…ï¼Œè¿™æ ·å¯ä»¥é¿å…ä¸€æ¬¡httpè¯·æ±‚jsæ–‡ä»¶


cache-controlæ§åˆ¶æµè§ˆå™¨ç¼“å­˜ï¼ˆExpires Cachingæ˜¯è¯¥å­—æ®µçš„ä¸€ä¸ªfallbackï¼‰
- no-cacheï¼šå¯ä»¥ç¼“å­˜ï¼Œä½†æ˜¯æ¯æ¬¡å»æœåŠ¡å™¨éªŒè¯ç¼“å­˜çš„æ•°æ®æ˜¯å¦å¯ç”¨
- no-store:ä¸å¯ä»¥ç¼“å­˜ï¼Œæ¯æ¬¡éƒ½è¦å»æœåŠ¡å™¨è¯·æ±‚æ–°çš„æ•°æ®
- must-revalidateï¼šå¦‚æœç¼“å­˜ä¸è¿‡æœŸå°±ç»§ç»­ä½¿ç”¨ï¼Œå¦‚æœç¼“å­˜è¿‡æœŸä¹‹åè¿˜æƒ³ä½¿ç”¨è¯¥ç¼“å­˜å°±å¿…é¡»å‘æœåŠ¡å™¨è¿›è¡ŒéªŒè¯
- publicï¼šèƒ½è¢«æµè§ˆå™¨ç¼“å­˜ï¼Œä¹Ÿèƒ½è¢«ä¸­é—´æœåŠ¡å™¨ç¼“å­˜
- privateï¼šåªèƒ½è¢«æµè§ˆå™¨ç¼“å­˜ï¼Œä¸­é—´è®¾å¤‡ä¸èƒ½ç¼“å­˜æ”¹æ•°æ®
- max-ageï¼šå¯ä»¥ç¼“å­˜çš„æ—¶é—´ï¼Œæœ€é«˜å¯ä»¥ç¼“å­˜ä¸€å¹´
- ï¼ˆno-cacheå’Œno-storeã€must-revalidateäº’æ–¥ï¼›privateå’Œpublicäº’æ–¥ï¼‰


#### åœ¨çœŸå®ç¯å¢ƒä¸‹å¦‚ä½•æµ‹é‡é¡µé¢çš„æ€§èƒ½
æµè§ˆå™¨åœ¨performanceå‘½åç¯å¢ƒä¸‹é¢æä¾›äº†ä¸€äº›apiæ¥ä¾›ç”¨æˆ·æµ‹é‡é¡µé¢çš„æ€§èƒ½
```js
// è·å–htmlæ–‡ä»¶çš„æ€§èƒ½æŒ‡æ ‡
performance.getEntriesByType('navigation');

// è·å–æ–‡ä»¶çš„æ€§èƒ½æŒ‡æ ‡ï¼ˆjsã€cssã€imgæ–‡ä»¶ç­‰ã€xhræ¥å£è¯·æ±‚ï¼‰
performance.getEntriesByType('resource');

// è·å–ç‰¹å®šæ¥å£çš„æ€§èƒ½æŒ‡æ ‡
performance.getEntriesByName('https://somesite.com/images/hero-image.jpg');
```

ä¸€äº›ç”¨äºæµ‹é‡é¡µé¢æ€§èƒ½çš„æŒ‡æ ‡ï¼š
```js
var pageNav = performance.getEntriesByType('navigation')[0];
// æŸ¥è¯¢DNSçš„æ—¶é—´
var dnsTime = pageNav.domainLookupEnd = pageNav.domainLookupStart;


// å¦‚æœæ˜¯httpè¯·æ±‚ï¼Œè¯·æ±‚çš„negotiation timeï¼ˆTCPå»ºç«‹æ—¶é—´ï¼‰
var connectionTime = pageNav.connectedEnd - pageNav.connectedStart; // å¯¹äºhttpsè€Œè¨€æ˜¯0
// å¦‚æœæ˜¯httpè¯·æ±‚ï¼Œè¯·æ±‚çš„negotiation timeï¼ˆTCPå»ºç«‹æ—¶é—´ã€TLSåå•†å¯†é’¥ç­‰æ—¶é—´ï¼‰
var connectionTime = pageNav.connectedEnd - pageNav.secureConnectedStart; // å¯¹äºhttpè€Œè¨€æ˜¯0

// åŒ…æ‹¬æ£€æŸ¥ç£ç›˜cacheçš„æ—¶é—´ï¼Œåº”è¯¥åŒ…æ‹¬äº†DNSæŸ¥è¯¢ã€negotiation Timeã€è·å–å®Œæ•´çš„æ–‡æ¡£æ—¶é—´
var fetechTime = pageNav.responseEnd - pageNav.fetchStart;

// ç½‘ç»œè¯·æ±‚æ—¶é—´ï¼ˆDNSã€negotiation Timeï¼‰
var totalTime = pageNav.responseEnd - pageNav.requestStart;
// downloadæ—¶é—´
var downloadTime = pageNav.responseEnd - pageNav.responseStart;
// TTFBæ—¶é—´
var ttfb = pageNav.responseStart - pageNav.requestStart;

// HTTP header size
// transferSizeè¡¨ç¤ºæ–‡ä»¶å…¨éƒ¨çš„å¤§å°
var headerSize = pageNav.transferSize - pageNav.encodedBodySize;
// æ–‡ä»¶çš„å‹ç¼©ç‡
var compressRatio = pageNav.decodedBodySize / pageNav.encodedBodySize;
```

ä½¿ç”¨Timing APIæ—¶å€™è¦æ³¨æ„çš„ä¸€äº›ä¿¡æ¯
- åœ¨è·¨åŸŸè®¿é—®èµ„æºçš„æ—¶å€™ï¼Œéœ€è¦è®¾ç½®Timing-Allow-Origin headeræ¥å…è®¸å…¶è®¿é—®Resource Timing APIæä¾›çš„ç›¸å…³ä¿¡æ¯
- getEntriesByTypeç­‰APIåœ¨æµè§ˆå™¨ä¸­å¹¶ä¸æ€»æ˜¯å®ç°äº†çš„
- å¯ä»¥é‡‡ç”¨PerformanceObserveræ¥ç›‘æ§é¡µé¢Performanceæ€§èƒ½

å¦‚ä½•ä¿å­˜Performanceç›¸å…³çš„æ•°æ®ï¼Ÿ
- navigator.sendBeacon APIæä¾›ä¸€ä¸ªéé˜»å¡çš„POST APIåœ¨unloadäº‹ä»¶å‘ç”Ÿçš„æ—¶å€™ï¼ˆä¸é˜»å¡é¡µé¢çš„è·³è½¬ï¼‰


### jsæ˜¯å¦‚ä½•å½±å“æ€§èƒ½çš„

#### ä¼ è¾“æ€§èƒ½ï¼ˆnetworkï¼‰
ç”¨æˆ·çš„ç½‘ç»œç¯å¢ƒå¯èƒ½ä¸æ˜¯å¾ˆå¥½ï¼Œæ‰€ä»¥éœ€è¦ä¼˜åŒ–jsä¼ è¾“çš„å¤§å°æ¥æé«˜æ€§èƒ½

- ä¼ è¾“ç”¨æˆ·éœ€è¦çš„js
  - ç”¨code-splittingæ¥åˆ†å‰²ä»£ç 
  - å¯¹äºéå…³é”®çš„jsçš„æ–‡ä»¶èµ„æºï¼Œå¯ä»¥ä½¿ç”¨æ‡’åŠ è½½
- minification
  - ç”¨Uglify JSæ¥youhua ES5çš„ä»£ç 
  - ç”¨babel-minifyæˆ–è€…uglify-esæ¥ä¼˜åŒ–ES2015+çš„ä»£ç 
- å‹ç¼©
  - ç”¨gzipçš„æ–¹å¼æ¥å‹ç¼©jsæ–‡ä»¶
  - Brotli~q11æ¥å‹ç¼©æ–‡ä»¶ï¼Œè¿™ç§å‹ç¼©æ–¹å¼æ¯”gzipè¦å¥½ä¸Šä¸€äº›
- ç§»é™¤ä¸éœ€è¦çš„ä»£ç 
  - ç”¨babel-preset-envæ¥é¿å…å¯¹ä¸€äº›åŠŸèƒ½çš„pollifyï¼ˆè¿™äº›åŠŸèƒ½å¾ˆå¯èƒ½å¤§å¤šæ•°æµè§ˆå™¨å·²ç»æ”¯æŒäº†ï¼‰
  - tree-shakingã€Closure Compilerâ€™s advanced optimizationsã€è¿˜æœ‰ä¸€äº›åº“çš„æ’ä»¶è¿›è¡Œtree-shaking
- ç¼“å­˜jsä»£ç 
  - HTTP caching
  - Service Worker cachingï¼ˆv8ï¼‰

#### è¿è¡Œæ€§èƒ½ï¼ˆcpuï¼‰
- parse/compile
  - ä»£ç å†™å¥½ä¸€ç‚¹
  - é¦–å±åŠ è½½çš„jsæ–‡ä»¶å°½å¯èƒ½çš„å°
- execution
  - é¿å…ä¸€ä¸ªjsä»»åŠ¡çš„æ‰§è¡Œè¶…è¿‡äº†50msï¼Œä¼šç»™ç”¨æˆ·äº¤äº’ç²˜æ»æ„Ÿ
  - å¦‚æœä»»åŠ¡è¿è¡Œæ—¶é—´è¿‡é•¿ï¼Œå¯ä»¥é‡‡ç”¨(using requestAnimationFrame() or requestIdleCallback())æ¥å‡ç¼“

#### ç°é˜¶æ®µjsä¼˜åŒ–ç­–ç•¥ï¼ˆV8å›¢é˜Ÿå»ºè®®ï¼‰
- js bundleè¦å°½å¯èƒ½çš„å°ï¼Œæœ€å¥½ä¸è¦è¶…è¿‡50KB~100KB
- é¿å…jsæ‰§è¡ŒLong Taskï¼Œè¿™æ ·ä¼šé˜»å¡ä¸»çº¿ç¨‹
- é¿å…å¤§çš„å†…è”js
  - KBæ˜¯ä¸€ä¸ªåˆ†ç•Œé¢ï¼Œå¤–éƒ¨å¼•ç”¨çš„jsæ–‡ä»¶å¤§äº1KBçš„æ—¶å€™ï¼ŒV8å¯¹jsçš„ç¼–è¯‘ç»“æœä¼šè¿›è¡Œç¼“å­˜ï¼Œå†…è”jsä»£ç åˆ™ä¸ä¼š
  - å†…è”ä»£ç çš„parseã€compileæ˜¯åœ¨ä¸»çº¿ç¨‹è¿›è¡Œçš„

### imgå’Œvideoå±æ€§çš„lazy loading

#### img
1ã€imgæ ‡ç­¾åªè¦è®¾ç½®äº†srcå±æ€§ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨ä¸‹è½½å›¾ç‰‡ï¼Œæ‰€ä»¥å¯ä»¥ä¸ºimgå…ƒç´ è®¾ç½®ä¸€ä¸ªdata-srcå±æ€§æ¥å­˜å‚¨å›¾ç‰‡çš„çœŸå®åç§°å’Œè·¯å¾„ï¼Œ
srcå±æ€§å…ˆè®¾ç½®äº†ä¸€ä¸ªplaceholderå›¾ç‰‡ã€‚ä¹‹åç»“åˆIntersectionObserve APIå’Œjsï¼Œå½“imgå…ƒç´ æ»šåŠ¨åˆ°viewportçš„æ—¶å€™ï¼Œè®¾ç½®
imgæ ‡ç­¾srcçš„çœŸå®å±æ€§ï¼Œloadingå›¾ç‰‡
```html
<img class="lazy" src="placeholder-image.jpg" data-src="image-to-lazy-load-1x.jpg" data-srcset="image-to-lazy-load-2x.jpg 2x, image-to-lazy-load-1x.jpg 1x" alt="I'm an image!">
<script>
document.addEventListener("DOMContentLoaded", function() {
  var lazyImages = [].slice.call(document.querySelectorAll("img.lazy"));

  if ("IntersectionObserver" in window) {
    let lazyImageObserver = new IntersectionObserver(function(entries, observer) {
      entries.forEach(function(entry) {
        if (entry.isIntersecting) {
          let lazyImage = entry.target;
          lazyImage.src = lazyImage.dataset.src;
          lazyImage.srcset = lazyImage.dataset.srcset;
          lazyImage.classList.remove("lazy");
          lazyImageObserver.unobserve(lazyImage);
        }
      });
    });

    lazyImages.forEach(function(lazyImage) {
      lazyImageObserver.observe(lazyImage);
    });
  } else {
    // Possibly fall back to a more compatible method here
  }
</script>
```
2ã€åœ¨cssä¸­è®¾ç½®å…ƒç´ çš„å±æ€§ï¼Œcssè®¾ç½®å…ƒç´ çš„background-imgeå±æ€§æœ‰äº›ä¸åŒï¼Œimgå±æ€§åªè¦è®¾ç½®äº†srcï¼Œæµè§ˆå™¨éƒ½ä¼šè¯·æ±‚èµ„æºã€‚
ä¸€æ¡cssè§„åˆ™è®¾ç½®äº†background-imgaå±æ€§æ—¶ï¼Œå½“è¿™æ¡cssè§„åˆ™æ²¡æœ‰è¢«åº”ç”¨çš„æ—¶å€™ï¼Œä¸ä¸‹è½½èµ„æºï¼Œå½“è¿™æ¡cssè§„åˆ™è¢«åº”ç”¨å»æ„å»º
domç»“æ„çš„æ—¶å€™ï¼Œæµè§ˆå™¨ä¼šè¯·æ±‚ç›¸å…³çš„èµ„æº
```css
.lazy-background {
  background-image: url("hero-placeholder.jpg"); /* Placeholder image */
}

.lazy-background.visible {
  background-image: url("hero.jpg"); /* The final image */
}
```
å½“ç”¨æˆ·æ»šåŠ¨åˆ°ç›¸å…³çš„åŒºåŸŸçš„æ—¶ï¼Œé€šè¿‡IntersectionObserve APIæ¥å°†å›¾ç‰‡tagå…ƒç´ çš„classä»lazy-backgroundæ”¹å˜ä¸ºlazy-backgroudn.visible
å°±èƒ½å¤Ÿå®ç°å›¾ç‰‡çš„æ‡’åŠ è½½ã€‚


#### vedio
1ã€å¯¹äºvideoæ ‡ç­¾çš„lazy loadingåªéœ€è¦è®¾ç½®å…¶å±æ€§preload = noneå³å¯å®ç°è§†é¢‘çš„æ‡’åŠ è½½ï¼Œåªæœ‰å½“ç”¨æˆ·æ’­æ”¾è§†é¢‘çš„æ—¶å€™ï¼Œè§†é¢‘æ–¹åŠ è½½ã€‚
posterå±æ€§ç±»ä¼¼äºimgæ ‡ç­¾çš„placeholderå±æ€§ï¼Œèƒ½å¤Ÿå®ç°å¯¹videoæ ‡ç­¾çš„å ä½ã€‚

2ã€videoä¹Ÿå¯ä»¥æ’­æ”¾gitå›¾ç‰‡ï¼Œé€šå¸¸è€Œè¨€videoçš„å‹ç¼©ç‡æ˜¯ä¼˜äºgifå›¾ç‰‡çš„ï¼Œåªæœ‰ä¸‹é¢çš„ä¸€äº›ä¸åŒ
- gif loadedä¹‹åæ˜¯è‡ªåŠ¨æ’­æ”¾çš„
- gif å¯èƒ½ä¼šæ— é™å¾ªç¯æ’­æ”¾
- gif æ²¡æœ‰videoçš„æ’­æ”¾æ¡

ä¸ºäº†æ¨¡æ‹Ÿgifçš„è¡¨ç°å½¢å¼ï¼Œå¯ä»¥å¯¹videoå±æ€§è®¾ç½®å¦‚ä¸‹çš„å±æ€§
```html
<video autoplay muted loop playsinline>
  <source src="one-does-not-simply.webm" type="video/webm">
  <source src="one-does-not-simply.mp4" type="video/mp4">
</video>
```


#### appendixï¼ˆIntersectionObserveï¼‰
```js
var io = new IntersectionObserver(entries => console.log(entries))
// elementæ˜¯ä¸€ä¸ªdomå…ƒç´ 
io.observe(element)
io.unobserve(element)

// entriesï¼ˆcallbackå›è°ƒä¸­çš„å‚æ•°ï¼‰æ˜¯ä¸€ä¸ªIntersectionObserveEntry Object
// å…¶ä¸»è¦éƒ¨åˆ†è¯´æ˜å¦‚ä¸‹

/*
ğŸ”½[IntersectionObserverEntry]
    time: 3893.92
  ğŸ”½rootBounds: ClientRect
      bottom: 920
      height: 1024
      left: 0
      right: 1024
      top: 0
      width: 920
  ğŸ”½boundingClientRect: ClientRect
    // ...
  ğŸ”½intersectionRect: ClientRect
    // ...
    intersectionRatio: 0.54
  ğŸ”½target: div#observee
    // ...
 */
// rootBoundsæ˜¯rootå…ƒç´ è°ƒç”¨getBoundingClientRect()çš„ç»“æœï¼Œé»˜è®¤æ˜¯viewport
// boundingClientRectæ˜¯è¢«è§‚æµ‹å…ƒç´ è°ƒç”¨çš„getBoundingClientRect()çš„ç»“æœ
// intersectionRectsæ˜¯rootå…ƒç´ å’Œè¢«è§‚æµ‹å…ƒç´ çš„äº¤å‰éƒ¨åˆ†çš„ä¿¡æ¯
// intersectionRatio æ˜¯å¯è§‚æµ‹å…ƒç´ èƒ½å¤Ÿè¢«è§‚æµ‹åˆ°çš„æ¯”ä¾‹
// targetåˆ™æ˜¯è¢«è§‚æµ‹çš„å…ƒç´ çš„domå¯¹è±¡å¼•ç”¨

// IntersectionObserverå¯¹è±¡æ¥æ”¶ä¸€ä¸ªoptionsçš„å‚æ•°ï¼Œç”¨æ¥é…ç½®IntersectionObserverçš„è¡¨ç°è¡Œä¸º
new IntersectionObserver(entries => {/* â€¦ */}, {
  // The root to use for intersection.
  // If not provided, use the top-level documentâ€™s viewport.
  root: null,
  // Same as margin, can be 1, 2, 3 or 4 components, possibly negative lengths.
  // If an explicit root element is specified, components may be percentages of the
  // root element size.  If no explicit root element is specified, using a percentage
  // is an error.
  rootMargin: "0px",
  // Threshold(s) at which to trigger callback, specified as a ratio, or list of
  // ratios, of (visible area / total area) of the observed element (hence all
  // entries must be in the range [0, 1]).  Callback will be invoked when the visible
  // ratio of the observed element crosses a threshold in the list.
  threshold: [0],
});
```


### Critical rendering path

#### æ¦‚è¿°
1. htmlä¼šè¢«æµè§ˆå™¨è§£æï¼ˆByte-character-token-nodes-DOMï¼‰ï¼Œç”ŸæˆDOMï¼ˆParse HTMLï¼ŒdevToolsï¼‰ï¼ŒDOMå¯ä»¥å¢é‡ç”Ÿæˆ
2. css styleä¼šè¢«æµè§ˆå™¨è§£ææˆä¸ºCSSOMï¼ŒCSSOMå’ŒDOMæ˜¯ç‹¬ç«‹çš„ä¸¤ä¸ªå¯¹è±¡ï¼ŒCSSOMä¸æ˜¯å¢é‡çš„ï¼Œå› ä¸ºcss Ruleå¯ä»¥è¦†ç›–ï¼Œæ‰€ä»¥éœ€è¦ä¸€æ¬¡æ€§è§£æå®Œï¼ˆRecalculate Styleï¼Œ devToolsï¼‰
3. æµè§ˆå™¨ä¼šå°†domå’Œcssomåˆå¹¶æˆrender treeï¼ˆåªåŒ…å«èƒ½æ˜¾ç¤ºçš„nodeèŠ‚ç‚¹ï¼Œæ¯”æ–¹è¯´styleã€scriptã€displayå±æ€§ä¸ºnoneçš„èŠ‚ç‚¹éƒ½ä¸åœ¨render treeä¸­ï¼‰
4. æµè§ˆå™¨åˆ©ç”¨render treeè¿›è¡Œlayoutå¸ƒå±€ï¼Œåœ¨layoutè¿‡ç¨‹ä¸­ç¡®å®šæ¯ä¸ªå…ƒç´ çš„å°ºå¯¸å’Œä½ç½®
5. æœ€åä¸€æ­¥æ˜¯paintï¼Œå°†render treeï¼ˆlayoutå¤„ç†è¿‡çš„ï¼‰æ¸²æŸ“åˆ°å±å¹•ä¸Šï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å¯èƒ½ä¼šåšcompositionï¼Œä¸€äº›csså±æ€§ä¼šåˆ›å»ºlayerï¼Œå¤šä¸ªlayeréœ€è¦compositeåˆæˆåœ¨ä¸€èµ·

#### å…³é”®èµ„æº
æµè§ˆå™¨é¦–å±æ¸²æŸ“çš„æ—¶å€™æœ‰ä¸€äº›å…³é”®æ€§èµ„æºï¼Œåªæœ‰è¿™äº›èµ„æºå…¨éƒ¨éƒ½å°±ç»ªçš„æ—¶å€™ï¼Œæ•´ä¸ªé¡µé¢æ‰è¢«å±•ç°ã€‚é˜»å¡æ€§ï¼šå½“htmlè§£æåˆ°è¯¥èµ„æºçš„æ—¶å€™ä¼šæš‚åœ
htmlæ–‡ä»¶çš„è§£æï¼Œè½¬è€Œå»è§£æç›¸å…³çš„é˜»å¡æ€§èµ„æº
- html
- css
  - é»˜è®¤æƒ…å†µä¸‹ï¼Œcssæ˜¯é˜»å¡æ€§èµ„æºï¼Œä¸ä¼šé˜»å¡domçš„è§£æï¼Œä½†æ˜¯ä¼šé˜»å¡é¦–å±æ¸²æŸ“ï¼ˆåˆæˆæ¸²æŸ“åçš„DOMæ ‘éœ€è¦CSSOMï¼‰
  - Media Typeå’Œmedia querieså¯ä»¥è®©æŸäº›cssèµ„æºå˜ä¸ºä¸é˜»å¡çš„éå…³é”®æ€§èµ„æº
  - ä¸è®ºcssæ–‡ä»¶æ˜¯å¦æ˜¯é˜»å¡æ€§èµ„æºï¼Œå…¶æ–‡ä»¶éƒ½ä¼šä¸‹è½½çš„
- js
  - jsé»˜è®¤æ˜¯é˜»å¡æ€§èµ„æºï¼Œèƒ½å¤Ÿé˜»å¡domã€cssomçš„æ„å»º
  - jså¢åŠ asyncå’Œdeferå…³é”®å­—çš„æ—¶å€™ä¼šæç¤ºæµè§ˆå™¨è¯¥æ–‡ä»¶ä¸æ˜¯é˜»å¡æ€§èµ„æº
  - jsé˜»å¡domçš„æ¸²æŸ“ï¼Œä¸”jså¯ä»¥è®¿é—®CSSOMï¼Œæ‰€ä»¥jsåœ¨æ‰§è¡Œä¹‹å‰ä¼šå…ˆä¸‹è½½scriptæ ‡ç­¾å‰é¢çš„cssæ–‡ä»¶ä¸”å®Œæˆcssomçš„æ„å»ºï¼Œè¿™æ ·cssä¹Ÿä¼šå˜æˆé˜»å¡æ€§èµ„æº


DOMCOntentLoadedäº‹ä»¶çš„è§¦å‘ï¼š
- åªè¦htmlè§£æå®Œæˆï¼Œå°±ä¼šè§¦å‘DOMContentLoadedäº‹ä»¶
- jsé»˜è®¤ä¼šé˜»å¡htmlçš„æ‰§è¡Œï¼Œå»¶ç¼“DOMContentLoadedäº‹ä»¶è§¦å‘çš„æ—¶é—´
- js deferå±æ€§ï¼Œéœ€è¦ä¿è¯jsåœ¨htmlè§£æå®Œæˆä¹‹åï¼Œåœ¨DOMContentLoadedäº‹ä»¶è§¦å‘ä¹‹å‰æ‰§è¡Œï¼Œæ‰€ä»¥ä¹Ÿä¼šå»¶ç¼“äº‹ä»¶çš„è§¦å‘æ—¶é—´
- js asyncå±æ€§ï¼Œjsä¸‹è½½å®Œæˆåç«‹å³æ‰§è¡Œjsï¼Œå¯èƒ½ä¼šå»¶ç¼“DOMContentLoadedäº‹ä»¶çš„è§¦å‘ï¼Œå¦‚æœjsä¸‹è½½å®Œæˆæ—¶ï¼Œhtmlè¿˜æ²¡æœ‰è§£æå®Œæˆï¼Œåˆ™å»¶ç¼“è§¦å‘æ—¶é—´ï¼Œå¦‚æœjsä¸‹è½½çš„æ—¶é—´æ¯”è¾ƒé•¿ï¼Œåœ¨ä¸‹è½½çš„è¿‡ç¨‹ä¸­ï¼Œhtmlè§£æå®Œæˆäº†ï¼Œè¿™æ—¶å€™ä¼šè§¦å‘DOMContentLoadedäº‹ä»¶

### Rendering Performance


### ç½‘é¡µè¿è¡Œæ—¶Performance overview
ç»Ÿå…±åˆ†ä¸ºEvaluate scriptã€recalculate Styleã€Layoutï¼ˆreflowï¼‰ã€Paint and composite

Evaluate Script
- é¡µé¢äº¤äº’çš„handlerï¼ˆjsï¼‰è®¡ç®—æ—¶é—´é•¿ã€å°½å¯èƒ½è®©æµè§ˆå™¨å¤„ç†touchã€scrollç­‰äº‹ä»¶ã€‘
- jsè®¡ç®—çš„æ—¶é—´è¿‡é•¿ã€ç”¨web Worksã€requestAnimationFrameã€‘
- é¢‘ç¹çš„åƒåœ¾å›æ”¶ã€çœ‹çœ‹ä»£ç æ˜¯ä¸æ˜¯å†™å‚»é€¼äº†ã€‘

Recaculate Styleï¼š
- æ”¹å˜å…ƒç´ å‡ ä½•å±æ€§ï¼ˆwidthã€heightã€positionï¼‰ï¼Œæµè§ˆå™¨è¦é‡æ–°ç”Ÿæˆlayoutå¸ƒå±€
- éå¸¸å¤æ‚åµŒå¥—çš„é€‰æ‹©å™¨ã€æµè§ˆå™¨èŠ±è´¹æ›´é•¿çš„æ—¶é—´ã€‘

Layoutï¼š
- å¼ºåˆ¶åŒæ­¥å¸ƒå±€ã€è®¾ç½®å…ƒç´ çš„å±æ€§ä¹‹åï¼Œå†è®¿é—®å…ƒç´ å±æ€§ï¼Œå¼ºåˆ¶æµè§ˆå™¨å‘ç”Ÿä¸€æ¬¡å¸ƒå±€ã€‘
- åŒæ­¥å¸ƒå±€æŠ–åŠ¨ã€åœ¨å¾ªç¯ä¸­ä¸æ–­åœ°é‡å¤å¼ºåˆ¶åŒæ­¥å¸ƒå±€ã€‘

Paint and compositeï¼ˆè¿™ä¸ªæ€§èƒ½é—®é¢˜åº”è¯¥ä¸æ˜¯å¾ˆå¤§ï¼‰
